services:
  TourGoApiProd:
    profiles: ["prod"]
    image: tourgo-api-prod
    build:
      context: .
      dockerfile: TourGo.Web.Api/Dockerfile
    environment:
      - ASPNETCORE_ENVIRONMENT=Production
      - ASPNETCORE_URLS=http://+:50002
      - ConnectionStrings__MySql=${SQL_CONN}
      - JsonWebTokenConfig__Secret=${JWT_SECRET}
      - BrevoConfig__ApiKey=${BREVO_KEY}
      - AWSS3Config__AccessKey=${S3_ACCESS}
      - AWSS3Config__SecretKey=${S3_SECRET}
      - EncryptionConfig__UserPIIKey=${PII_KEY}
      - GoogleRecaptchaConfig__SecretKey=${RECAPTCHA_KEY}
    restart: always
    extra_hosts:
      - "host.docker.internal:host-gateway"
    ports:
      - "50001:50002"
  TourGoApiStage:
    profiles: ["stage"]
    image: tourgo-api-stage
    build:
      context: .
      dockerfile: TourGo.Web.Api/Dockerfile
    environment:
      - ASPNETCORE_ENVIRONMENT=Staging
      - ASPNETCORE_URLS=http://+:50002
      - ConnectionStrings__MySql=${SQL_CONN}
      - JsonWebTokenConfig__Secret=${JWT_SECRET}
      - BrevoConfig__ApiKey=${BREVO_KEY}
      - AWSS3Config__AccessKey=${S3_ACCESS}
      - AWSS3Config__SecretKey=${S3_SECRET}
      - EncryptionConfig__UserPIIKey=${PII_KEY}
      - GoogleRecaptchaConfig__SecretKey=${RECAPTCHA_KEY}
      - OTEL_EXPORTER_OTLP_PROTOCOL="http/protobuf"
      - OTEL_EXPORTER_OTLP_ENDPOINT="https://otlp-gateway-prod-us-east-2.grafana.net/otlp"
      - OTEL_EXPORTER_OTLP_HEADERS="Authorization=Basic ${GRAFANA_OTLP_AUTH}"
    restart: always
    extra_hosts:
      - "host.docker.internal:host-gateway"
    ports:
      - "50002:50002"
  TourGoApiDev:
    profiles: ["dev"]
    image: tourgo-api-dev
    build:
      context: .
      dockerfile: TourGo.Web.Api/Dockerfile
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ASPNETCORE_URLS=http://+:50002
    ports:
      - "50001:50002"
    restart: always
