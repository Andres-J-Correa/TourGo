server {
    listen 80;
    
    # HOST AND PORT HANDLING
    # Disable absolute redirects so Nginx sends "Location: /app/" instead of "http://localhost:80/app/"
    absolute_redirect off;
    port_in_redirect off;

    # Root is one level above 'app' because the build is copied to /usr/share/nginx/html/app
    root /usr/share/nginx/html;

    # Landing Page Assets
    location /landing-assets/ {
        alias /usr/share/nginx/html/app/landing-assets/;
        expires 1y;
        add_header Cache-Control "public, immutable";
        try_files $uri =404;
    }

    # React App Assets (Vite uses /assets/)
    location ~ ^/app/assets/ {
        expires 1y;
        add_header Cache-Control "public, immutable";
        try_files $uri =404;
    }
    
    # Prevent caching for entry points
    location ~ ^/app/(index\.html|service-worker\.js)$ {
        add_header Cache-Control "no-cache, no-store, must-revalidate";
        try_files $uri =404;
    }

    # --- Application Routes ---

    # React App (SPA Support)
    location ~ ^/app(/.*)?$ {
        index index.html;
        try_files $uri $uri/ /app/index.html;
    }

    # Landing Page (Root)
    location / {
        try_files $uri /app/landing.html =404;
        add_header Cache-Control "no-cache";
    }
}